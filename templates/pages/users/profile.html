{% extends "base.html" %}

{% block title %}tapne | Profile{% endblock %}

{% block content %}
<article class="detail-shell">
    <p class="eyebrow">Public profile</p>
    <h1>
        {% if profile.display_name %}
        {{ profile.display_name }} <span class="muted-inline">(@{{ profile.username }})</span>
        {% else %}
        @{{ profile.username|default:"username" }}
        {% endif %}
    </h1>
    {% if viewer_is_member %}
    <p class="profile-mode-note">Member view: profile actions are enabled where allowed.</p>
    {% else %}
    <p class="profile-mode-note">Guest view: reading is available, actions require login/signup.</p>
    {% endif %}

    <p>{{ profile.bio|default:"No bio available yet." }}</p>

    <dl class="card-meta-grid">
        <div>
            <dt>Location</dt>
            <dd>{{ profile.location|default:"Not provided" }}</dd>
        </div>
        <div>
            <dt>Followers</dt>
            <dd>{{ profile_followers_count|default:0 }}</dd>
        </div>
        <div>
            <dt>Website</dt>
            <dd>
                {% if profile.website %}
                <a href="{{ profile.website }}" target="_blank" rel="noopener noreferrer">{{ profile.website }}</a>
                {% else %}
                Not provided
                {% endif %}
            </dd>
        </div>
    </dl>

    <div class="inline-actions">
        {% if is_owner %}
        <a class="btn btn-primary" href="{% url 'accounts:me-edit' %}">Edit profile</a>
        <a class="btn btn-secondary" href="{% url 'accounts:me' %}">Go to my profile hub</a>
        {% elif can_interact %}
        {% if is_following_profile %}
        <form method="post" action="{% url 'social:unfollow' username=profile.username %}" class="inline-form">
            {% csrf_token %}
            <input type="hidden" name="next" value="{{ request.get_full_path }}">
            <button class="btn btn-primary" type="submit">Unfollow</button>
        </form>
        {% else %}
        <form method="post" action="{% url 'social:follow' username=profile.username %}" class="inline-form">
            {% csrf_token %}
            <input type="hidden" name="next" value="{{ request.get_full_path }}">
            <button class="btn btn-primary" type="submit">Follow</button>
        </form>
        {% endif %}
        <form method="post" action="{% url 'interactions:dm-open' %}" class="inline-form">
            {% csrf_token %}
            <input type="hidden" name="with" value="{{ profile.username }}">
            <input type="hidden" name="next" value="{{ request.get_full_path }}">
            <button class="btn btn-secondary" type="submit">Message</button>
        </form>
        <form method="post" action="{% url 'social:bookmark' %}" class="inline-form">
            {% csrf_token %}
            <input type="hidden" name="type" value="user">
            <input type="hidden" name="id" value="{{ profile.username }}">
            <input type="hidden" name="next" value="{{ request.get_full_path }}">
            <button class="btn btn-ghost" type="submit">Bookmark profile</button>
        </form>
        {% elif viewer_is_member and not profile_user_exists %}
        <button class="btn btn-primary" type="button" disabled>Follow unavailable</button>
        <button class="btn btn-secondary" type="button" disabled>Message unavailable</button>
        <button class="btn btn-ghost" type="button" disabled>Bookmark unavailable</button>
        {% else %}
        <button class="btn btn-primary js-guest-action" type="button" data-action-label="follow this user">Follow</button>
        <button class="btn btn-secondary js-guest-action" type="button" data-action-label="message this user">Message</button>
        <button class="btn btn-ghost js-guest-action" type="button" data-action-label="bookmark this user">Bookmark profile</button>
        {% endif %}
    </div>
</article>
{% endblock %}
