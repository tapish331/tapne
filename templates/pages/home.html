{% extends "base.html" %}

{% block title %}tapne | Home{% endblock %}

{% block content %}
<section class="hero home-hero">
    <h1>Find your kind of people. <span class="home-hero-accent">Then travel.</span></h1>
    <p class="home-hero-subheading">Join community-led trips with like-minded travelers. Discover adventures, make friends, and explore the world together.</p>

    {% with selected_type=request.GET.type|default:"all" %}
    <form class="search-form home-hero-search" method="get" action="/search/" data-navbar-dock-source>
        <label class="sr-only" for="homeSearchType">Search type</label>
        <select id="homeSearchType" name="type">
            <option value="all" {% if selected_type == "all" %}selected{% endif %}>All</option>
            <option value="trips" {% if selected_type == "trips" %}selected{% endif %}>Trips</option>
            <option value="users" {% if selected_type == "users" %}selected{% endif %}>User</option>
            <option value="blogs" {% if selected_type == "blogs" %}selected{% endif %}>Blogs</option>
        </select>
        <label class="sr-only" for="homeSearchQuery">Search query</label>
        <input
            id="homeSearchQuery"
            name="q"
            type="search"
            placeholder="Try Bali, @host, or food guide..."
            value="{{ request.GET.q|default:'' }}"
        >
        <button class="btn btn-primary" type="submit">Search</button>
    </form>
    {% endwith %}

    <div class="home-hero-stats" aria-label="Community metrics">
        <div class="home-hero-stat">
            <span class="home-hero-stat-icon" aria-hidden="true">
                <svg viewBox="0 0 24 24" focusable="false">
                    <path d="M12 21s7-6 7-11a7 7 0 1 0-14 0c0 5 7 11 7 11z"></path>
                    <circle cx="12" cy="10" r="2.6"></circle>
                </svg>
            </span>
            <span class="home-hero-stat-value">{{ total_unique_destinations }}</span>
            <span class="home-hero-stat-label">Destinations</span>
        </div>
        <div class="home-hero-stat">
            <span class="home-hero-stat-icon" aria-hidden="true">
                <svg viewBox="0 0 24 24" focusable="false">
                    <circle cx="8" cy="9" r="3"></circle>
                    <circle cx="16.5" cy="10" r="2.4"></circle>
                    <path d="M3.5 18.2c.8-2.5 2.8-4 5.5-4s4.8 1.5 5.6 4"></path>
                    <path d="M13.7 18.2c.6-1.8 2.1-2.9 4.2-2.9 1.1 0 2.1.3 2.8.9"></path>
                </svg>
            </span>
            <span class="home-hero-stat-value">{{ total_authenticated_users }}</span>
            <span class="home-hero-stat-label">Travelers</span>
        </div>
        <div class="home-hero-stat">
            <span class="home-hero-stat-icon" aria-hidden="true">
                <svg viewBox="0 0 24 24" focusable="false">
                    <circle cx="12" cy="12" r="8"></circle>
                    <path d="M10 14l2-6 2 2-4 4z"></path>
                    <circle cx="12" cy="12" r="1.2"></circle>
                </svg>
            </span>
            <span class="home-hero-stat-value">{{ total_trips_created }}</span>
            <span class="home-hero-stat-label">Trips Created</span>
        </div>
    </div>
</section>

<section class="section-grid">
    <header class="section-header">
        <h2>Upcoming trips</h2>
        <a href="/trips/">Browse all trips</a>
    </header>
    {% if trips %}
    <div class="card-carousel-shell" data-card-carousel>
        <button
            class="card-carousel-arrow card-carousel-arrow-prev"
            type="button"
            aria-label="Scroll upcoming trips left"
            aria-controls="homeUpcomingTripsCarousel"
            data-carousel-prev
        >
            <svg viewBox="0 0 24 24" focusable="false" aria-hidden="true">
                <path d="M14.5 5.8L8.3 12l6.2 6.2"></path>
            </svg>
        </button>
        <div id="homeUpcomingTripsCarousel" class="card-carousel" aria-label="Upcoming trips carousel" tabindex="0">
            {% for trip in trips|slice:":8" %}
            {% include "partials/cards/trip_card.html" with trip=trip card_variant="home-upcoming" %}
            {% endfor %}
        </div>
        <button
            class="card-carousel-arrow card-carousel-arrow-next"
            type="button"
            aria-label="Scroll upcoming trips right"
            aria-controls="homeUpcomingTripsCarousel"
            data-carousel-next
        >
            <svg viewBox="0 0 24 24" focusable="false" aria-hidden="true">
                <path d="M9.5 5.8L15.7 12l-6.2 6.2"></path>
            </svg>
        </button>
    </div>
    {% else %}
    <div class="empty-state">No upcoming trips yet. Create the first trip to seed this section.</div>
    {% endif %}
</section>

<section class="section-grid">
    <header class="section-header">
        <h2>Destinations</h2>
        <a href="/search/?type=trips">Explore destinations</a>
    </header>
    {% if destinations %}
    <div class="card-carousel-shell" data-card-carousel>
        <button
            class="card-carousel-arrow card-carousel-arrow-prev"
            type="button"
            aria-label="Scroll destinations left"
            aria-controls="homeDestinationsCarousel"
            data-carousel-prev
        >
            <svg viewBox="0 0 24 24" focusable="false" aria-hidden="true">
                <path d="M14.5 5.8L8.3 12l6.2 6.2"></path>
            </svg>
        </button>
        <div id="homeDestinationsCarousel" class="card-carousel" aria-label="Destinations carousel" tabindex="0">
            {% for destination in destinations|slice:":8" %}
            {% include "partials/cards/destination_card.html" with destination=destination %}
            {% endfor %}
        </div>
        <button
            class="card-carousel-arrow card-carousel-arrow-next"
            type="button"
            aria-label="Scroll destinations right"
            aria-controls="homeDestinationsCarousel"
            data-carousel-next
        >
            <svg viewBox="0 0 24 24" focusable="false" aria-hidden="true">
                <path d="M9.5 5.8L15.7 12l-6.2 6.2"></path>
            </svg>
        </button>
    </div>
    {% else %}
    <div class="empty-state">No destinations yet. Add trip locations to populate this section.</div>
    {% endif %}
</section>

<section class="section-grid">
    <header class="section-header">
        <h2>Blogs</h2>
        <a href="/blogs/">Read all blogs</a>
    </header>
    {% if blogs %}
    <div class="card-carousel-shell" data-card-carousel>
        <button
            class="card-carousel-arrow card-carousel-arrow-prev"
            type="button"
            aria-label="Scroll blogs left"
            aria-controls="homeBlogsCarousel"
            data-carousel-prev
        >
            <svg viewBox="0 0 24 24" focusable="false" aria-hidden="true">
                <path d="M14.5 5.8L8.3 12l6.2 6.2"></path>
            </svg>
        </button>
        <div id="homeBlogsCarousel" class="card-carousel" aria-label="Blogs carousel" tabindex="0">
            {% for blog in blogs|slice:":8" %}
            {% include "partials/cards/blog_card.html" with blog=blog %}
            {% endfor %}
        </div>
        <button
            class="card-carousel-arrow card-carousel-arrow-next"
            type="button"
            aria-label="Scroll blogs right"
            aria-controls="homeBlogsCarousel"
            data-carousel-next
        >
            <svg viewBox="0 0 24 24" focusable="false" aria-hidden="true">
                <path d="M9.5 5.8L15.7 12l-6.2 6.2"></path>
            </svg>
        </button>
    </div>
    {% else %}
    <div class="empty-state">No blogs yet. Publish a first post to populate this feed.</div>
    {% endif %}
</section>
{% endblock %}

{% block body_extra %}
{{ block.super }}
<script>
    (function initHomeCarousels() {
        var carouselShells = document.querySelectorAll("[data-card-carousel]");
        if (!carouselShells.length) {
            return;
        }

        function bindCarousel(shell) {
            var track = shell.querySelector(".card-carousel");
            var prevButton = shell.querySelector("[data-carousel-prev]");
            var nextButton = shell.querySelector("[data-carousel-next]");
            if (!track || !prevButton || !nextButton) {
                return;
            }

            function stepSize() {
                return Math.max(Math.floor(track.clientWidth * 0.85), 260);
            }

            function updateState() {
                var maxScrollLeft = Math.max(0, track.scrollWidth - track.clientWidth);
                var atStart = track.scrollLeft <= 2;
                var atEnd = track.scrollLeft >= maxScrollLeft - 2;
                prevButton.disabled = atStart;
                nextButton.disabled = atEnd;
                shell.classList.toggle("is-static", maxScrollLeft <= 2);
            }

            prevButton.addEventListener("click", function () {
                track.scrollBy({ left: -stepSize(), behavior: "smooth" });
            });
            nextButton.addEventListener("click", function () {
                track.scrollBy({ left: stepSize(), behavior: "smooth" });
            });
            track.addEventListener("scroll", updateState, { passive: true });
            window.addEventListener("resize", updateState);
            updateState();
        }

        for (var i = 0; i < carouselShells.length; i += 1) {
            bindCarousel(carouselShells[i]);
        }
    })();
</script>
{% endblock %}

