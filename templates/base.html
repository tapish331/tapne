{% load static %}
<!doctype html>
<html lang="en" data-user-state="{% if user.is_authenticated %}member{% else %}guest{% endif %}">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="tapne: host trips, write blogs, and grow audiences.">
    <title>{% block title %}tapne{% endblock %}</title>
    {% if canonical_url %}<link rel="canonical" href="{{ canonical_url }}">{% endif %}
    <link rel="stylesheet" href="{% static 'css/tapne.css' %}">
    <script>
        // Frontend runtime flags shared with static JS helpers.
        window.TAPNE_RUNTIME = {
            userState: "{% if user.is_authenticated %}member{% else %}guest{% endif %}",
            verbose: "{% if request.GET.verbose %}{{ request.GET.verbose }}{% else %}0{% endif %}"
        };
    </script>
    <script src="{% static 'js/tapne-ui.js' %}" defer></script>
    {% block head_extra %}{% endblock %}
</head>
<body>
    <header class="site-header">
        <div class="container header-inner">
            <a class="brand" href="/">tapne</a>
            <nav class="site-nav" aria-label="Primary navigation">
                <a href="/">Home</a>
                <a href="/search/">Search</a>
                <a href="/trips/">Trips</a>
                <a href="/blogs/">Blogs</a>
                {% if user.is_authenticated %}
                <a href="/interactions/dm/">Messages</a>
                <a href="/enroll/hosting/inbox/">Hosting Inbox</a>
                <a href="/social/bookmarks/">Bookmarks</a>
                <a href="/activity/">Activity</a>
                <a href="/settings/">Settings</a>
                {% endif %}
            </nav>
            <div class="auth-links">
                {% if user.is_authenticated %}
                <a class="btn btn-secondary" href="/accounts/me/">My Profile</a>
                <form method="post" action="/accounts/logout/" class="inline-form">
                    {% csrf_token %}
                    <button class="btn btn-ghost" type="submit">Log out</button>
                </form>
                {% else %}
                <button class="btn btn-primary" type="button" data-modal-open="auth" data-auth-mode="login">Log in</button>
                {% endif %}
            </div>
        </div>
    </header>

    <main class="site-main">
        <div class="container">
            {% if messages %}
            <section class="flash-list" aria-label="Notifications">
                {% for message in messages %}
                <div class="flash flash-{{ message.tags|default:'info' }}">{{ message }}</div>
                {% endfor %}
            </section>
            {% endif %}
            {% block content %}{% endblock %}
        </div>
    </main>

    <footer class="site-footer">
        <div class="container footer-inner">
            <p>tapne local UI scaffold</p>
            <p>Guest and member behaviors are progressively enhanced in shared JS.</p>
        </div>
    </footer>

    {% include "partials/modals/login_prompt_modal.html" %}
    {% block body_extra %}{% endblock %}
</body>
</html>
